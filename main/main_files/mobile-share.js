define(["zepto"],function($){var tpl='<div id="js-share-screen" class="mui-screen mask hide"><div id="js-share-dialog" class="mui-dialog show-top share-dialog"><div class="mui-dlg-con"><div class="content"><div class="share-head" ><label>分享到：</label><div class="share-select" data-role="share-select"><a href="javascript:;" data-role="sina" class="cur"><span class="ki-t i-sina"></span></a><a href="javascript:;" data-role="qzone" class=""><span class="ki-t i-zone"></span></a><a href="javascript:;" data-role="qqweibo" class=""><span class="ki-t i-txwb"></span></a><a href="javascript:;" data-role="renren" class=""><span class="ki-t i-rr"></span></a></div></div><textarea class="mui-text share-text" placeholder=""></textarea></div><div><div class="mui-btn-group two-col"><a href="javascript:;" class="mui-btn first" data-role="cancel">取消</a><a href="javascript:;" class="mui-btn confirm last" data-role="share">分享</a></div></div></div></div></div>',url_map={renren:"http://widget.renren.com/dialog/share?resourceUrl={{url}}&title={{title}}&pic={{pic}}&description={{desc}}",qzone:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={{url}}&desc={{desc}}&pics={{url}}",douban:"http://www.douban.com/recommend/?url={{url}}&title={{title}}&sel=&v=1",qqweibo:"http://share.v.t.qq.com/index.php?c=share&a=index&title={{title}}&url={{url}}",sina:"http://v.t.sina.com.cn/share/share.php?title={{desc}}&nbsp;&nbsp;&nbsp;{{url}}&pic={{pic}}",weixin:"javascript:;"};var share={init:function(screen,share_data){var m=this,d={type:"sina"};screen.on("click","[data-role=share-select] a",function(){var t=$(this);t.siblings().removeClass("cur");t.addClass("cur");d.type=t.data("role")}).on("click","[data-role=cancel]",function(){m.hide(screen)}).on("click","[data-role=share]",function(){var url=url_map[d.type],new_url=url+"";d.desc=screen.find("textarea").val();$.each({url:/{{url}}/gi,desc:/{{desc}}/gi,title:/{{title}}/gi,pic:/{{pic}}/gi},function(i,v){new_url=new_url.replace(v,share_data[i])});window.location=new_url})},hide:function(dialog){dialog.addClass("hide")},show:function(dialog){dialog.removeClass("hide")},open:function(share_data){var screen=$("#js-share-screen");if(screen.length===0){screen=$(tpl);$("body").append(screen);this.init(screen,share_data)}this.show(screen)}};return share});